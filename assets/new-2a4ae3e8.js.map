{"version":3,"file":"new-2a4ae3e8.js","sources":["../../../../node_modules/react-spinners/esm/CircleLoader.js","../../src/pages/new.tsx"],"sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nimport * as React from \"react\";\nimport { cssValue, parseLengthAndUnit } from \"./helpers/unitConverter\";\nimport { createAnimation } from \"./helpers/animation\";\nvar circle = createAnimation(\"CircleLoader\", \"0% {transform: rotate(0deg)} 50% {transform: rotate(180deg)} 100% {transform: rotate(360deg)}\", \"circle\");\nfunction CircleLoader(_a) {\n    var _b = _a.loading, loading = _b === void 0 ? true : _b, _c = _a.color, color = _c === void 0 ? \"#000000\" : _c, _d = _a.speedMultiplier, speedMultiplier = _d === void 0 ? 1 : _d, _e = _a.cssOverride, cssOverride = _e === void 0 ? {} : _e, _f = _a.size, size = _f === void 0 ? 50 : _f, additionalprops = __rest(_a, [\"loading\", \"color\", \"speedMultiplier\", \"cssOverride\", \"size\"]);\n    var wrapper = __assign({ display: \"inherit\", position: \"relative\", width: cssValue(size), height: cssValue(size) }, cssOverride);\n    var style = function (i) {\n        var _a = parseLengthAndUnit(size), value = _a.value, unit = _a.unit;\n        return {\n            position: \"absolute\",\n            height: \"\".concat(value * (1 - i / 10)).concat(unit),\n            width: \"\".concat(value * (1 - i / 10)).concat(unit),\n            borderTop: \"1px solid \".concat(color),\n            borderBottom: \"none\",\n            borderLeft: \"1px solid \".concat(color),\n            borderRight: \"none\",\n            borderRadius: \"100%\",\n            transition: \"2s\",\n            top: \"\".concat(i * 0.7 * 2.5, \"%\"),\n            left: \"\".concat(i * 0.35 * 2.5, \"%\"),\n            animation: \"\".concat(circle, \" \").concat(1 / speedMultiplier, \"s \").concat((i * 0.2) / speedMultiplier, \"s infinite linear\"),\n        };\n    };\n    if (!loading) {\n        return null;\n    }\n    return (React.createElement(\"span\", __assign({ style: wrapper }, additionalprops),\n        React.createElement(\"span\", { style: style(0) }),\n        React.createElement(\"span\", { style: style(1) }),\n        React.createElement(\"span\", { style: style(2) }),\n        React.createElement(\"span\", { style: style(3) }),\n        React.createElement(\"span\", { style: style(4) })));\n}\nexport default CircleLoader;\n","import React, { useCallback, useEffect, useState } from 'react'\nimport { Event } from 'ethers'\nimport { useForm } from 'react-hook-form'\nimport { Helmet } from 'react-helmet'\nimport { useSearchParams } from 'react-router-dom'\nimport { OptionsForm, Header, SubmitButton } from '@/components'\nimport { useWeb3 } from '@/lib/hooks'\nimport { extractMessage } from '@/lib/helpers'\nimport { rolePermissions, tokenPermissions } from '@/config'\nimport { CircleLoader } from 'react-spinners'\nimport Tippy from '@tippyjs/react'\nimport { toast } from 'react-toastify'\nimport ns from '../styles/new.module.css'\n\nexport const New = () => (\n  <section>\n    <Helmet>\n      <title>‚Äôùñàùñçùñéùñäùñõùñä: ‚≤ö‚≤â‚≤± ‚≤¶‚≤ü‚≤ï‚≤â‚≤õ</title>\n    </Helmet>\n    <Header/>\n    <Content/>\n  </section>\n)\n\nconst Content: React.FC = () => {\n  const {\n    ensProvider, roContract, rwContract, rolesLibrary,\n    connecting, connect, chain, address,\n  } = useWeb3()\n  const [search, setSearch] = useSearchParams({ tokenId: '' })\n  const id = search.get('tokenId')\n  const [tokenId, setTokenId] = (\n    useState(Array.isArray(id) ? id[0] : id)\n  )\n  const [roles, setRoles] = (\n    useState<Array<string>>(tokenPermissions)\n  )\n  const [working, setWorking] = useState(false)\n  const { register, handleSubmit } = useForm()\n\n  useEffect(() => {\n    if(typeof id === 'string') {\n      setTokenId(id)\n    }\n  }, [id])\n\n  useEffect(() => {\n    const load = async () => {\n      if(roContract) {\n        const numRoles = (await rolesLibrary.roleIndexForName('ReservedLast')) - 1\n        const roles: Array<string> = await Promise.all(\n          Array.from({ length: numRoles }).map(async (_, idx) => (\n            await rolesLibrary.roleNameByIndex(idx + 1)\n          ))\n        )\n        setRoles(roles)\n      }\n    }\n\n    // load() // load static list to avoid extraneous permissions\n  }, [roContract])\n\n  const reserve = useCallback(async (data: Record<string, unknown>) => {\n    setWorking(true)\n\n    try {\n      if(!rwContract) {\n        throw new Error(\n          'Connect your wallet to reserve an id.'\n        )\n      }\n      if(!rolesLibrary){\n        throw new Error('Library not loaded.')\n      }\n      const grants: Array<number> = []\n      const disables: Array<number> = []\n      await Promise.all(Object.entries(data).map(\n        async ([key, value]: [key: string, value: unknown]) => {\n          if(typeof value === 'boolean' && value) {\n            const [, type, role] = key.match(/^(grant|disable)\\((.+)\\)$/) ?? []\n            const roleId = await rolesLibrary.roleIndexForName(role)\n            switch(type) {\n              case 'grant': {\n                grants.push(roleId)\n                break\n              }\n              case 'disable': {\n                disables.push(roleId)\n                break\n              }\n              default: {\n                throw new Error(`Unknown operation: ${type}`)\n              }\n            }\n          }\n        }\n      ))\n\n      let { maintainer }: { maintainer?: string } = data\n      if(maintainer === '') {\n        maintainer = address\n      }\n      if(maintainer == null) {\n        throw new Error('`maintainer` is not set.')\n      }\n      if(maintainer.includes('.')) {\n        if(!ensProvider) {\n          throw new Error('ENS provider not defined.')\n        }\n        maintainer = (\n          (await ensProvider.resolveName(maintainer))\n          ?? undefined\n        )\n      }\n      const tx = await rwContract['create(address,uint8[],uint8[])'](\n        maintainer, grants, disables\n      )\n      const receipt = await tx.wait()\n      const event = receipt.events.find(\n        (evt: Event) => evt.event === 'Created'\n      )\n      if(!event) {\n        throw new Error(\n          'Couldn‚Äôt find a creation event.'\n        )\n      }\n      const [id] = event.args\n      setTokenId(id.toHexString())\n    } catch(error) {\n      toast.error(extractMessage(error))\n      console.error((error as Error).stack)\n    } finally {\n      setWorking(false)\n    }\n  }, [address, ensProvider, rolesLibrary, rwContract])\n\n  if(!rwContract || !tokenId || working) {\n    return (\n      <main id={ns.new}>\n        <h1>Create a New Token Type</h1>\n        {(() => {\n          if(connecting) {\n            return (\n              <section>\n                <CircleLoader color=\"#FF7301\" size={100}/>\n                <h2>Connecting‚Ä¶</h2>\n              </section>\n            )\n          }\n          if(working) {\n            return (\n              <section>\n                <CircleLoader color=\"#6EA8FF\" size={100}/>\n                <h2>Reserving your token‚Ä¶</h2>\n              </section>\n            )\n          }\n          if(!tokenId) {\n            return (\n              <form onSubmit={handleSubmit(reserve)}>\n                <label id={ns.admin}>\n                  <h2>Admin</h2>\n                  <input\n                    {...register('maintainer')}\n                    placeholder=\"Maintainer Address (default Creator)\"\n                  />\n                </label>\n                <table>\n                  <thead>\n                    <tr>\n                      <th>Role</th>\n                      <th>\n                        <Tippy content=\"Give the admin these roles:\">\n                          <span>Grant</span>\n                        </Tippy>\n                      </th>\n                      <th>\n                        <Tippy content=\"Prevent these permissions from being checked:\">\n                          <span>Disable</span>\n                        </Tippy>\n                      </th>\n                      <th>Description</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {roles.map((role, idx) => (\n                      <tr key={idx}>\n                        <td>{role}</td>\n                        <td>\n                          <input type=\"checkbox\" {...register(`grant(${role})`)}/>\n                        </td>\n                        <td>\n                          <input type=\"checkbox\" {...register(`disable(${role})`)}/>\n                        </td>\n                        <td>\n                          {rolePermissions[role as keyof typeof rolePermissions]}\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n                <SubmitButton\n                  purpose=\"create\"\n                  label=\"Reserve an ID\"\n                  className=\"full\"\n                  requireStorage={false}\n                />\n              </form>\n            )\n          }\n          return (\n            <p>¬øHow‚Äôd we get here?</p>\n          )\n        })()}\n      </main>\n    )\n  }\n\n  return (\n    <OptionsForm {...{ tokenId }}/>\n  )\n}\n\nexport default New"],"names":["this","_a","React.createElement","Helmet","useState","useEffect","useCallback","id","toast"],"mappings":"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","x_google_ignoreList":[0]}